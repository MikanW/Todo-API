# Todo list REST API
当プロジェクトは、Spring Boot・MySQLにより、Todoアイテムの取得・追加・更新・削除のAPIを提供する。



## APIの説明

現時点、Localhostで稼働。

### 一括取得

全todoアイテムを取得する

- メソッド：GET
- URL：http://localhost:8081/items/getAllItems
- リクエストBODY：BODY不要
- リスポンスSTATUS：
  - 200：取得成功
  - 204：リクエスト正常処理したが、既存アイテム無し
  - 他も追加予定。DBエラーなど。
- リスポンスBODY：アイテムのリストまたは空リスト

以下、取得成功時のリスポンスBODY例
```json
{
    "items": [
        {
            "id": 5,
            "title": "title",
            "detail": "詳細",
            "due": "2024-05-01",
            "status": "作業中"
        },
        {
          "id": 10,
          "title": "買い出し",
          "detail": "牛乳、お肉",
          "due": "2024-04-01",
          "status": "完了"
        }
    ]
}
```

### 追加

指定情報よりアイテムを新規作成し、追加する

- メソッド：POST
- URL：http://localhost:8081/items/createNewItem
- リクエストBODY:新規アイテムの登録情報
例：
```json
{
    "title": "買い出し",
    "detail" : "牛乳、お肉",
    "status" : "完了",
    "due" : "2024-04-01",
    "invalid": "invalid"
}
```
備考：妥当性チェックを行い、以下該当の場合は400となる
- Keyチェック：定義されていない属性・クライエントより指定不可の属性
- Valueチェック：必須項目が未設定または空白・文字列長さオーバー

（現状、妥当性チェック処理は一部のみ実装済み。徐々追加する予定。）

- リスポンスSTATUS：
    - 200：作成成功
    - 400: 指定データ不正（妥当性チェックと伴い追加予定）
- リスポンスBODY：新規アイテムまたはエラー情報（作成失敗の場合）

以下、作成成功時のリスポンスBODY例

```json
{
    "newItem": {
        "id": 11,
        "title": "買い出し",
        "detail": "牛乳、お肉",
        "due": "2024-05-01",
        "status": "完了"
    }
}
```


### 更新

指定アイテムを更新する。複数属性更新可。

- メソッド：PATCH
- URL：http://localhost:8081/items/updateItem
- リクエストBODY:更新アイテムのID及び更新属性群
   - 例：


```
{
    "id": 9,
    "update":
    {
        "status": "完了",
        "mTime": "2025-02-02"
    }
}
```

- 備考：妥当性チェックを行い、以下該当の場合は400となる

  - Keyチェック：定義されていない属性・クライエントより指定不可の属性

  - Valueチェック：指定値不正など

- リスポンスSTATUS

  - 200：アイテム更新成功
  - 400：更新内容不正
  - 404：指定IDに紐づくアイテム存在しない

- リスポンスBODY

  - 更新フラグ　updated
    - true：更新済み、又は不正内容を除外した後の一部更新済み
    - false: 未更新、指定内容全部不正

  - 更新後アイテム　updatedItem
  - 更新失敗内容　updateFailedProps　（妥当性チェックエラーのため除外されたもの）

- リスポンスBODY例（一部更新の場合）

```
{
    "updateFailedProps": "mTime",
    "updateItem": {
        "id": 9,
        "title": "title",
        "detail": "wwwww",
        "due": "2024-05-01",
        "status": "完了"
    },
    "updated": "true"
}
```



### 削除

- メソッド：POST
- URL：http://localhost:8081/items/deleteItem
- リクエストBODY：削除アイテムのID
- リスポンスSTATUS
  - 200：アイテム削除成功
  - 404：指定IDに紐づくアイテム存在しない
- リスポンスBODY：削除済みID又はエラーメッセージ

例：

```
{
    "errorMessage": "DBから指定idのアイテムが見つからない 134"
}
```





## プロジェクトの構成



### ソース



```
.
│   ├── main
│   │   ├── java
│   │   │   └── com
│   │   │       └── todo
│   │   │           └── app
│   │   │               ├── ApiApplication.java // メインクラス
│   │   │               ├── api/        // REST API
│   │   │               ├── dto/        // データ転換オブジェクト・機能を提供する
│   │   │               ├── entity/     //　DB用Entity
│   │   │               ├── exception/  //　例外
│   │   │               ├── repository/ //　DBアクセス処理
│   │   │               ├── service/    //  業務ロジック
│   │   │               └── util/       //　共通ライブラリー
│   └── test/                           //　単体テスト
```



### DBテーブル



```agsl
+---------+---------------+------+-----+---------+----------------+
| Field   | Type          | Null | Key | Default | Extra          |
+---------+---------------+------+-----+---------+----------------+
| id      | int           | NO   | PRI | NULL    | auto_increment |
| title   | varchar(50)   | YES  |     | NULL    |                |
| detail  | varchar(1000) | YES  |     | NULL    |                |
| status  | tinyint       | NO   |     | NULL    |                |
| due     | bigint        | YES  |     | NULL    |                |
| ctime   | bigint        | NO   |     | NULL    |                |
| mtime   | bigint        | NO   |     | NULL    |                |
| dtime   | bigint        | YES  |     | NULL    |                |
| deleted | tinyint(1)    | NO   |     | NULL    |                |
+---------+---------------+------+-----+---------+----------------+
```





## こだわり



### データベース設計面



#### データ型のサイズ

各Fieldが使用するデータTypeは、情報を保存できる範囲で、サイズが小さいほうとする。

例：各種時間はbigint(JavaのLong)とし、Unixタイムスタンプを保存する。

　　ステータスは文字列ではなくて、数字コードで保存する。

#### 削除フラグ

真偽型の削除フラグを設置している。

将来的な機能追加を考慮し、APIによりアイテムを削除時、本当にDBからレコードを削除ではなく、フラグをONにする。

#### 各種時間

アイテムの期限以外に、作成時間・前回更新時間・完了時間のFieldも設置している。

今回仕様は特に指定していないが、全アイテムを取得APIについては、何らかの順番でソートするはずなので、

起票順・完了順・最近変更順なども想定し、上記Fieldを設置した。



### 実装面

#### デカップリング考慮

API(Controller), 業務ロジック(Service), DB処理(Repository)の３層構成

#### Entity（DB用）とDTO（APIやり取り用）を分ける

以下のメリットを考えた結果、アイテムを定義するクラスは、２種類としている。

- デカップリングのため。フロント側仕様変更しても、DBまで大きな改修ではなく、DTO仕様を修正で済む。
    例:DB保存の「期限」はタイムスタンプ形式で、APIより取得する場合、DTOより仕様規定の"yyyy-MM-dd"形式で提供する。
    仕様が変更となる場合。

- 必要だけのデータ、APIとやり取りをし、ネットワークコストの削減ができる。また、DBの構成もバレないようにできる。

- 将来機能拡張がしやすい。
　例：アイテムデータを全く違うフォーマットのデータを提供するためには、さらにDTOを追加だけで良い。


#### Enumを活用

TableのFiledや、アイテムのステータスなど、一定の範囲から値を決定する項目は、Enumクラスを設置している。

また、Enumクラスにメソッドも追加。（例：Statusの文字列から、数値コードを決定するメソッド。各Fieldは、リクエストより更新可否を判断するメソッド。）

関連機能を一箇所に揃い、拡張・保守しやすい。



